(this["webpackJsonpobjects-in-mirror"]=this["webpackJsonpobjects-in-mirror"]||[]).push([[0],{16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"ActionType",(function(){return w})),n.d(r,"updateBounds",(function(){return O})),n.d(r,"mouseDownCamRoot",(function(){return M})),n.d(r,"mouseDownCamPan",(function(){return S})),n.d(r,"mouseDownSphereRoot",(function(){return g})),n.d(r,"mouseDownSphereScale",(function(){return R})),n.d(r,"mouseMove",(function(){return C})),n.d(r,"mouseUp",(function(){return N}));var o={};n.r(o),n.d(o,"bounds",(function(){return P})),n.d(o,"cam",(function(){return E})),n.d(o,"sphere",(function(){return W})),n.d(o,"reflSphere",(function(){return L})),n.d(o,"povSphere",(function(){return U})),n.d(o,"povReflSphere",(function(){return B})),n.d(o,"povWalls",(function(){return I})),n.d(o,"raysInfo",(function(){return q}));var a,c=n(1),s=n.n(c),u=n(9),i=n.n(u),p=n(5),h=n(3),l=n(4),f=function(){function e(){Object(h.a)(this,e),this.type=void 0,this.offset=void 0}return Object(l.a)(e,[{key:"match",value:function(e){switch(this.type){case a.None:return e.none();case a.CamRoot:return e.camRoot();case a.CamPan:return e.camPan();case a.SphereRoot:return e.sphereRoot(this.offset);case a.SphereScale:return e.sphereScale()}}}],[{key:"None",value:function(){var t=new e;return t.type=a.None,t}},{key:"CamRoot",value:function(){var t=new e;return t.type=a.CamRoot,t}},{key:"CamPan",value:function(){var t=new e;return t.type=a.CamPan,t}},{key:"SphereRoot",value:function(t){var n=new e;return n.type=a.SphereRoot,n.offset=t,n}},{key:"SphereScale",value:function(){var t=new e;return t.type=a.SphereScale,t}}]),e}();!function(e){e.None="None",e.CamRoot="CamRoot",e.CamPan="CamPan",e.SphereRoot="SphereRoot",e.SphereScale="SphereScale"}(a||(a={}));var m=function(){function e(t,n){Object(h.a)(this,e),this.x=t,this.y=n}return Object(l.a)(e,[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"minus",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"scale",value:function(t){return new e(t*this.x,t*this.y)}},{key:"rotate",value:function(t){var n=this.x,r=this.y,o=Math.cos(t),a=Math.sin(t);return new e(o*n-a*r,a*n+o*r)}},{key:"length",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"norm",value:function(){var e=this.length();if(0===e)throw new Error("attempt to norm 0-vector");return this.scale(1/e)}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"clampRect",value:function(t,n){return new e(d(this.x,t.x,n.x),d(this.y,t.y,n.y))}}]),e}();function d(e,t,n){return e<t?t:e>n?n:e}var w,j=function(){function e(t,n,r,o){Object(h.a)(this,e),this.pos=t,this.angle=n,this.fl=r,this.width=o}return Object(l.a)(e,[{key:"moveTo",value:function(t){return new e(t,this.angle,this.fl,this.width)}},{key:"panTo",value:function(t){return new e(this.pos,t,this.fl,this.width)}},{key:"transformPos",value:function(e){var t=e.minus(this.pos).rotate(-this.angle+Math.PI/2),n=t.x,r=t.y,o=r,a=(-this.fl*n/Math.abs(r)+this.width/2)/this.width*Y;return new m(a,o)}},{key:"insideViewbox",value:function(e){return e.y>0&&e.x>=0&&e.x<Y}}]),e}(),y=function e(t,n){Object(h.a)(this,e),this.pos=t,this.radius=n},v=function(){function e(t,n,r){Object(h.a)(this,e),this.pos=t,this.radius=n,this.angle=r}return Object(l.a)(e,[{key:"moveTo",value:function(t){return new e(t,this.radius,this.angle)}},{key:"scale",value:function(t,n){return new e(this.pos,t,n)}},{key:"transform",value:function(e){var t=e.transformPos(this.pos),n=e.fl*this.radius/t.y/e.width*Y;return new y(t,n)}}]),e}(),x=function(){function e(t,n){Object(h.a)(this,e),this.pos=t,this.radius=n}return Object(l.a)(e,[{key:"transform",value:function(e){var t=e.transformPos(this.pos),n=e.fl*this.radius/t.y/e.width*Y;return new y(t,n)}}]),e}(),b=function e(t,n,r){Object(h.a)(this,e),this.x=t,this.width=n,this.className=r};function O(e){return{type:w.UpdateBounds,payload:e}}function M(){return{type:w.MouseDownCamRoot}}function S(){return{type:w.MouseDownCamPan}}function g(e){return{type:w.MouseDownSphereRoot,payload:e}}function R(){return{type:w.MouseDownSphereScale}}function C(e){return{type:w.MouseMove,payload:e}}function N(){return{type:w.MouseUp}}!function(e){e.UpdateBounds="UpdateBounds",e.MouseDownCamRoot="MouseDownCamRoot",e.MouseDownCamPan="MouseDownCamPan",e.MouseDownSphereRoot="MouseDownSphereRoot",e.MouseDownSphereScale="MouseDownSphereScale",e.MouseMove="MouseMove",e.MouseUp="MouseUp"}(w||(w={}));var D=n(10),k=n(2);function P(e){return e.bounds}function E(e){return e.cam}function W(e){return e.sphere}function L(e){var t=e.sphere,n=t.pos,r=t.radius,o=J+J-n.x;return new x(new m(o,n.y),r)}function U(e){var t=e.sphere.transform(e.cam);return t.pos.y<=0?null:t}function B(e){var t=L(e).transform(e.cam);return t.pos.y<=0?null:t}function I(e){var t=F.map((function(t){return Object(k.a)(Object(k.a)({},t),{},{pos:e.cam.transformPos(t.pos)})}));return function(e,t){for(var n=[],r=0;r<e.length-t+1;r++)n.push(e.slice(r,r+t));return n}([].concat(Object(D.a)(t),[t[0]]),2).filter((function(e){var t=Object(p.a)(e,2),n=t[0],r=t[1];return n.pos.y>0||r.pos.y>0})).map((function(e){var t=Object(p.a)(e,2),n=t[0],r=t[1];return[Object(k.a)(Object(k.a)({},n),{},{pos:T(n.pos)}),Object(k.a)(Object(k.a)({},r),{},{pos:T(r.pos)})]})).map((function(e){var t,n,r=Object(p.a)(e,2),o=r[0],a=r[1],c=o.pos.x,s=a.pos.x-o.pos.x,u=(t=o.name,n=a.name,t===z.NW&&n===z.NE?"wall north":t===z.NE&&n===z.SE?"wall mirror":t===z.SE&&n===z.SW?"wall south":"wall west");return new b(c,s,u)}))}function T(e){if(e.y<0){var t=e.x<Y/2?0:Y;return new m(t,e.y)}return e}function q(e){var t=e.sphere,n=e.cam,r=new m(J+J-n.pos.x,n.pos.y),o=r.minus(t.pos),a=Math.sqrt(Math.pow(o.length(),2)-Math.pow(t.radius,2)),c=Math.atan2(a,t.radius),s=o.norm().scale(t.radius),u=s.rotate(c).plus(t.pos),i=s.rotate(-c).plus(t.pos),p=(J-u.x)/(r.x-u.x),h=(J-i.x)/(r.x-i.x),l=(r.y-u.y)*p+u.y,f=(r.y-i.y)*h+i.y,d=function(e){var t=e.sphere,n=e.cam.pos.minus(t.pos),r=Math.sqrt(Math.pow(n.length(),2)-Math.pow(t.radius,2)),o=Math.atan2(r,t.radius),a=n.norm().scale(t.radius),c=a.rotate(o).plus(t.pos),s=a.rotate(-o).plus(t.pos);return{wing1:c,wing2:s}}(e),w=d.wing1,j=d.wing2,y=function(e){var t=e.cam,n=L(e),r=t.pos.minus(n.pos),o=Math.sqrt(Math.pow(r.length(),2)-Math.pow(n.radius,2)),a=Math.atan2(o,n.radius),c=r.norm().scale(n.radius),s=c.rotate(a).plus(n.pos),u=c.rotate(-a).plus(n.pos);return{wing1:s,wing2:u}}(e);return{wing1:w,wing2:j,reflWing1:y.wing1,reflWing2:y.wing2,mirrorWing1:u,mirrorWing2:i,y1:l,y2:f}}function Z(e,t){switch(t.type){case w.UpdateBounds:return function(e,t){return Object(k.a)(Object(k.a)({},e),{},{bounds:t})}(e,t.payload);case w.MouseDownCamRoot:return function(e){return Object(k.a)(Object(k.a)({},e),{},{dragSubject:f.CamRoot()})}(e);case w.MouseDownCamPan:return function(e){return Object(k.a)(Object(k.a)({},e),{},{dragSubject:f.CamPan()})}(e);case w.MouseDownSphereRoot:return function(e,t){return Object(k.a)(Object(k.a)({},e),{},{dragSubject:f.SphereRoot(t)})}(e,t.payload);case w.MouseDownSphereScale:return function(e){return Object(k.a)(Object(k.a)({},e),{},{dragSubject:f.SphereScale()})}(e);case w.MouseMove:return function(e,t){return e.dragSubject.match({none:function(){return e},camRoot:function(){return Object(k.a)(Object(k.a)({},e),{},{cam:e.cam.moveTo(t)})},camPan:function(){var n=t.minus(e.cam.pos),r=Math.atan2(n.y,n.x);return Object(k.a)(Object(k.a)({},e),{},{cam:e.cam.panTo(r)})},sphereRoot:function(n){var r=e.sphere.radius,o=t.plus(n).clampRect(new m(r,r),new m(J-r,J-r));return Object(k.a)(Object(k.a)({},e),{},{sphere:e.sphere.moveTo(o)})},sphereScale:function(){var n=t.minus(e.sphere.pos),r=n.length(),o=n.angle();return Object(k.a)(Object(k.a)({},e),{},{sphere:e.sphere.scale(r,o)})}})}(e,t.payload);case w.MouseUp:return function(e){return Object(k.a)(Object(k.a)({},e),{},{dragSubject:f.None()})}(e);default:return e}}var z,J=400,X=400,Y=800,A=200,V={bounds:{left:0,top:0},cam:new j(new m(80,265),-Math.PI/8,60,120),dragSubject:f.None(),sphere:new v(new m(280,80),45,-Math.PI/4)};!function(e){e[e.NW=0]="NW",e[e.NE=1]="NE",e[e.SE=2]="SE",e[e.SW=3]="SW"}(z||(z={}));var F=[{name:z.NW,pos:new m(0,0)},{name:z.NE,pos:new m(J,0)},{name:z.SE,pos:new m(J,X)},{name:z.SW,pos:new m(0,X)}],G=s.a.createContext({state:null,dispatch:null});var H=n(0),K=function(){var e=s.a.useContext(G),t=e.state,n=e.dispatch,a=o.cam(t),c=a.pos,u=a.angle,i=a.fl,p=a.width,h=new m(i,0).rotate(u),l=c.plus(h),f=h.rotate(Math.PI/2).norm().scale(p/2),d=l.plus(f),w=l.minus(f),j="M ".concat(c.x," ").concat(c.y," L ").concat(d.x," ").concat(d.y," L ").concat(w.x," ").concat(w.y," Z");return Object(H.jsxs)("g",{className:"camera",children:[Object(H.jsx)("path",{d:j}),Object(H.jsx)("circle",{className:"camera-ctrl move",cx:c.x,cy:c.y,r:"8",onMouseDown:function(){return n(r.mouseDownCamRoot())}}),Object(H.jsx)("circle",{className:"camera-ctrl move",cx:l.x,cy:l.y,r:"8",onMouseDown:function(){return n(r.mouseDownCamPan())}})]})},Q=function(){var e=s.a.useContext(G),t=e.state,n=e.dispatch,a=o.sphere(t),c=a.pos,u=a.radius,i=a.angle,p=new m(u,0).rotate(i).plus(c);return Object(H.jsxs)("g",{className:"sphere",children:[Object(H.jsx)("circle",{className:"move",cx:c.x,cy:c.y,r:u,onMouseDown:function(e){var a=o.bounds(t),s=a.left,u=a.top,i=e.clientX,p=e.clientY,h=new m(i-s,p-u),l=c.minus(h);return n(r.mouseDownSphereRoot(l))}}),Object(H.jsx)("circle",{className:"sphere-ctrl move",cx:p.x,cy:p.y,r:"8",onMouseDown:function(){return n(r.mouseDownSphereScale())}})]})},$=function(){var e=s.a.useContext(G).state,t=o.reflSphere(e),n=t.pos,r=t.radius;return Object(H.jsx)("circle",{className:"refl-sphere",cx:n.x,cy:n.y,r:r})},_=function(){var e=s.a.useContext(G).state,t=o.cam(e),n=o.raysInfo(e),r=n.wing1,a=n.wing2,c=n.reflWing1,u=n.reflWing2,i=n.mirrorWing1,p=n.mirrorWing2,h=n.y1,l=n.y2,f="M ".concat(t.pos.x," ").concat(t.pos.y," L ").concat(r.x," ").concat(r.y," L ").concat(a.x," ").concat(a.y," Z"),m="M ".concat(t.pos.x," ").concat(t.pos.y," L ").concat(c.x," ").concat(c.y," L ").concat(u.x," ").concat(u.y," Z"),d="M ".concat(J," ").concat(h," L ").concat(i.x," ").concat(i.y," L ").concat(p.x," ").concat(p.y," L ").concat(J," ").concat(l," Z");return Object(H.jsxs)("g",{className:"rays",children:[Object(H.jsx)("path",{d:f}),Object(H.jsx)("path",{d:m}),Object(H.jsx)("path",{d:d})]})},ee=function(){var e=s.a.useContext(G).dispatch,t=s.a.useRef(null);return function(e,t){var n=s.a.useRef(t.onMove),r=s.a.useRef(t.onUp);s.a.useLayoutEffect((function(){function t(t){var r=t.clientX,o=t.clientY,a=e.left,c=e.top;return n.current(new m(r-a,o-c))}function o(){return r.current()}return document.addEventListener("mousemove",t),document.addEventListener("mouseup",o),function(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",o)}}),[e,n,r])}(function(e,t){var n=s.a.useState({left:0,top:0}),r=Object(p.a)(n,2),o=r[0],a=r[1],c=s.a.useRef(t),u=s.a.useCallback((function(){if(e.current){var t=e.current.getBoundingClientRect(),n=t.left+8,r=t.top+8;a({left:n,top:r}),c.current({left:n,top:r})}}),[e]);return s.a.useLayoutEffect((function(){return u(),window.addEventListener("resize",u),function(){return window.removeEventListener("resize",u)}}),[u]),o}(t,(function(t){return e(r.updateBounds(t))})),{onMove:function(t){return e(r.mouseMove(t))},onUp:function(){return e(r.mouseUp())}}),Object(H.jsxs)("svg",{id:"room",width:2*J,height:X,ref:t,children:[Object(H.jsx)(_,{}),Object(H.jsx)(K,{}),Object(H.jsx)(Q,{}),Object(H.jsx)($,{}),Object(H.jsx)("rect",{className:"mirror-room",x:J,y:"0",width:J,height:X}),Object(H.jsx)("line",{className:"mirror",x1:J,y1:"0",x2:J,y2:X})]})},te=function(){var e=s.a.useContext(G).state,t=o.povSphere(e),n=o.povReflSphere(e);return Object(H.jsxs)("svg",{id:"pov",width:Y,height:A,children:[n&&Object(H.jsx)("circle",{className:"refl-sphere",cx:n.pos.x,cy:100,r:n.radius}),o.povWalls(e).map((function(e){return Object(H.jsx)("rect",{className:e.className,x:e.x,width:e.width,height:A},e.className)})),t&&Object(H.jsx)("circle",{className:"sphere",cx:t.pos.x,cy:100,r:t.radius})]})},ne=function(){var e=s.a.useReducer(Z,V),t=Object(p.a)(e,2),n=t[0],r=t[1];return Object(H.jsx)(G.Provider,{value:{state:n,dispatch:r},children:Object(H.jsxs)("main",{children:[Object(H.jsx)(ee,{}),Object(H.jsx)(te,{})]})})};n(16);i.a.render(Object(H.jsx)(s.a.StrictMode,{children:Object(H.jsx)(ne,{})}),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.091411e3.chunk.js.map